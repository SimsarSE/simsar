{% include 'base.html' %}

{% block content %}
    <div class="row" align="center">
        <div class="col-md-12" align="center">
            {% if product.product_photo %}
                <img src="{{ product.product_photo.url }}" width="500">
            {% endif %}
        </div>
    </div>
    <div class="row">
        <div class="col-md-12" align="center">
            <a href="{% url 'profile' pk=product.seller.id %}"> {{ product.seller.username }}  </a>
            <h1>{{ product.productname }}</h1>
            <p>{{ product.quantity }}</p>
            <p>{{ product.bread_date }}</p>
            <p>{{ product.harvest_date }}</p>
            <p>{{ product.location }}</p>
            <p id="price">{{ product.price }}</p>
            <button id="buy" class="btn btn-success">
                Buy
            </button>
            {% if  not has_offer %}
                <button type="button" class="btn btn-danger" data-toggle="modal" data-target="#modalForm">
                    Offer
                </button>
            {% endif %}

            <p>{{ product.product_content }}</p>
        </div>
    </div>

    <div align="center">
        {% if product.seller == request.user %}
            <a href="{% url 'product_edit' pk=product.pk %}"> Edit <span class="glyphicon glyphicon-pencil"></span> </a>
        {% endif %}



        <div align="center" class="modal fade" id="modalForm" role="dialog">
            <div class="modal-dialog">
                <div class="modal-content" style="height: 250px; ">
                    <p style="margin-top: 20px"><b>Offer</b><br></p>
                    <input type="text" id="offer_value" value="{{ product.price }}" style="margin-top: 50px"> <br>
                    <button class="btn btn-success" id="submit" style="margin-top: 20px">Offer
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        $("#submit").click(function () {
            var data = document.getElementById("offer_value").value.replace(/\D/g, "");
            $.ajax({
                type: "POST",
                url: "{% url 'deal' pk=product.id %}",
                data: {"offer": data, csrfmiddlewaretoken: '{{ csrf_token }}'},
                success: $('#modalForm').modal('hide')
            })

        });
    </script>
    <script>
        $("#buy").click(function () {
            var data2 = document.getElementById("price");
            $.ajax({
                type: "POST",
                url: "{% url 'buy' pk=product.id %}",
                data: {"cost": data2, csrfmiddlewaretoken: '{{ csrf_token }}'},
                success: alert("You bought successfully")

            })
        })
    </script>
{% endblock %}